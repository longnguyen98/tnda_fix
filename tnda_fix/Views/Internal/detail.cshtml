
@{
    ViewBag.Title = "detail";
    Layout = "~/Views/Shared/InternalLayout.cshtml";
}
<script>
    $(document).ready(function () {
        $.LoadingOverlay("show");
        var url_string = window.location.href;
        var url = new URL(url_string);
        $('#current_location').val(url_string);
        var id = url.searchParams.get("id");
        $.ajax({
            url: "/person/getPersonDetail",
            data: { id: id },
            success: function (result) {
                $('.my-content').addClass("d-flex");
                $('.my-content').addClass("justify-content-center");
                $('.my-content').addClass("row");
                $('.my-content').show();
                $.ajax({
                    url: "/GradeAndClass/getAllGrades",
                    success: function (result2) {
                        for (var i = 0; i < result2.length; i++) {
                            console.log(result.grade);
                            console.log(result2[i].gradeName);
                            if (result.grade == result2[i].gradeName) {
                                $("#grades").append('<option value="' + result2[i].ID + '" selected>' + result2[i].gradeName + '</option>');
                            } else {
                                $("#grades").append(new Option(result2[i].gradeName, result2[i].ID));
                            }
                        }
                        getClasses();
                    }
                });
                new Vue({
                    el: '#vue-app',
                    data: {
                        detail: result,
                        glvlink: '/external/detail?id=' + result.glv_id
                    }
                });
                new Vue({
                    el: '#edit-modal',
                    data: {
                        detail: result,
                        glvlink: '/external/detail?id=' + result.glv_id
                    },
                    mounted: function () {

                    }
                });
                new Vue({
                    el: '#edit-class-modal',
                    data: {
                        detail: result,
                        glvlink: '/external/detail?id=' + result.glv_id
                    },
                    mounted: function () {

                    }
                });
            }
        });
    });
    function getClasses() {
        var grade_id = $('#grades').val();
        $('#classes').html('');
        $.ajax({
            url: "/GradeAndClass/getClassByGrade",
            data: { id: grade_id },
            success: function (result) {
                for (var i = 0; i < result.length; i++) {
                    $("#classes").append(new Option(result[i].className, result[i].ID));
                }
                $.LoadingOverlay("hide");
            }
        });
    }
</script>
<br />
<div class="bg-light" id="vue-app">
    <div v-if="detail.role_id==4" class="my-content" style="display:none">
        <div class="row mb-2 shadow" style="width:80%">
            <div class="col-lg-12">
                <div class="card d-flex">
                    <div class="card-body row d-flex justify-content-center">
                        <div class="col-lg-2 col-sm-6 mb-2">
                            <img class="card-img-top rounded" :src="detail.img" alt="Img" />
                        </div>
                        <div class="col-lg-5 col-sm-12 mb-2">
                            <p><h5 class="card-title">{{detail.ch_name}} {{detail.fname}} {{detail.name}}</h5></p>
                            <h6 class="card-subtitle mb-2 text-muted">{{detail.role}}</h6>
                            <p class="card-text">Ngày sinh: <b>{{detail.birth}}</b></p>
                            <p class="card-text">Địa chỉ: <b>{{detail.address}}</b></p>
                        </div>
                        <div class="col-lg-5 col-sm-12 mb-2">
                            <p class="card-text"></p>
                            <p class="card-text">Lớp: <b>{{detail.pclass}}</b></p>
                            <p class="card-text">Giáo Lý Viên: <b>{{detail.glv}}</b></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mb-2 shadow" style="width:80%">
            <div class="col-lg-12 col-sm-12">
                <div class="card d-flex">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-lg-6 col-sm-12">
                                <h5 class="card-title">{{detail.father.ch_name}} {{detail.father.fname}} {{detail.father.name}}</h5>
                                <h6 class="card-subtitle mb-2 text-muted">Phụ huynh</h6>
                                <p class="card-text">Số điện thoại: <b>{{detail.father.phone}}</b></p>
                            </div>
                            <div class="col-lg-6 col-sm-12">
                                <h5 class="card-title">{{detail.mother.ch_name}} {{detail.mother.fname}} {{detail.mother.name}}</h5>
                                <h6 class="card-subtitle mb-2 text-muted">Phụ huynh</h6>
                                <p class="card-text">
                                    Số điện thoại: <b>{{detail.mother.phone}}</b>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mb-2 shadow" style="width:80%">
            <div class="col-lg-12 col-sm-12 mb-2">
                <div class="card d-flex">
                    <div class="card-body">
                        <button type="button" class="btn btn-info" data-toggle="modal" data-target="#edit-modal">Sửa thông tin</button>
                        <button type="button" class="btn btn-info" data-toggle="modal" data-target="#edit-class-modal">Sửa lớp</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bd-example-modal-lg vue-app" id="edit-modal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content p-5">
            <form action="/person/EditPerson" method="post">
                <input name="current_location" id="current_location" type="hidden" />
                <div class="form-group">
                    <input hidden type="text" class="form-control" :value=detail.id name="child-id">
                </div>
                <div class="form-group">
                    <label>Tên thánh</label>
                    <input type="text" class="form-control" :value=detail.ch_name name="child-ch-name" required pattern="\S+.*">
                </div>
                <div class="form-group">
                    <label>Họ và đệm </label>
                    <input type="text" class="form-control" :value=detail.fname name="child-fname" required pattern="\S+.*">
                </div>
                <div class="form-group">
                    <label>Tên</label>
                    <input type="text" class="form-control" :value=detail.name name="child-name" required pattern="\S+.*">
                </div>
                <div class="form-group">
                    <label>Ngày tháng năm sinh</label>
                    <input type="text" class="form-control" :value=detail.birth name="child-birth" required>
                </div>
                <div class="form-group">
                    <label>Giới tính</label>
                    <select class="form-control" name="child-gender">
                        <option value="true">Nam</option>
                        <option value="false">Nữ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Lớp hiện tại</label>
                    <input type="text" class="form-control" :value=detail.pclass  readonly>
                    @*<select id="classes" class="form-control" name="child-class"></select>*@
                </div>
                <div class="form-group">
                    <label>Địa chỉ</label>
                    <input type="text" class="form-control" :value=detail.address name="child-address" required>
                </div>
                <br />
                <h4 class="font-weight-bold">Bố</h4>
                <div class="form-group">
                    <input hidden type="text" class="form-control" :value=detail.father.fa_id name="fa-id" readonly>
                    <label>Tên Thánh</label>
                    <input type="text" class="form-control" :value=detail.father.ch_name name="fa-ch-name" required pattern="\S+.*">
                </div>
                <div class="form-group">
                    <label>Họ và đệm</label>
                    <input type="text" class="form-control" :value=detail.father.fname name="fa-fname" required pattern="\S+.*">
                </div>
                <div class="form-group">
                    <label>Tên</label>
                    <input type="text" class="form-control" :value=detail.father.name name="fa-name" required pattern="\S+.*">
                </div>
                <div class="form-group">
                    <label>SDT</label>
                    <input type="text" class="form-control" :value=detail.father.phone name="fa-phone" required>
                </div>
                <br />
                <h4 class="font-weight-bold">Mẹ</h4>
                <div class="form-group">
                    <input hidden type="text" class="form-control" :value=detail.mother.mo_id name="mo-id" readonly>
                    <label>Tên Thánh</label>
                    <input type="text" class="form-control" :value=detail.mother.ch_name name="mo-ch-name" required pattern="\S+.*">
                </div>
                <div class="form-group">
                    <label>Họ và đệm</label>
                    <input type="text" class="form-control" :value=detail.mother.fname name="mo-fname" required pattern="\S+.*">
                </div>
                <div class="form-group">
                    <label>Tên</label>
                    <input type="text" class="form-control" :value=detail.mother.name name="mo-name" required pattern="\S+.*">
                </div>
                <div class="form-group">
                    <label>SDT</label>
                    <input type="text" class="form-control" :value=detail.mother.phone name="mo-phone" required>
                </div>
                <button type="submit" class="btn btn-primary w-100">Lưu</button>
            </form>
        </div>
    </div>
</div>
<div class="modal fade bd-example-modal-lg vue-app" id="edit-class-modal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content p-5">
            <form action="/person/EditClass" method="post">
                <input name="current_location" id="current_location" type="hidden" />
                <div class="form-group">
                    <input hidden type="text" class="form-control" :value=detail.id name="child-id">
                </div>
                <div class="form-group">
                    <h3>{{detail.ch_name}} {{detail.fname}} {{detail.name}}</h3>
                </div>
                <div class="form-group">
                    <label>Khối</label>
                    <select id="grades" onchange="getClasses()" class="form-control" name="child-grade"></select>
                </div>
                <div class="form-group">
                    <label>Lớp</label>
                    <select id="classes" class="form-control" name="child-class"></select>
                </div>
                <button type="submit" class="btn btn-primary w-100">Lưu</button>
            </form>
        </div>
    </div>
</div>





